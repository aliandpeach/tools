<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tool.doge.mapper.IDownloaderMapper">

    <insert id="saveDownloadCategories" parameterType="com.tool.doge.model.DownloadCategories">
        INSERT INTO DOWNLOAD_CATEGORIES
        <trim prefix="(" suffix=")" suffixOverrides=",">
            `url`,`file_name`, `file_hash`, `file_label`, `file_type`, `success`
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            #{url}, #{fileName}, #{fileHash}, #{fileLabel}, #{fileType}, #{success,jdbcType=BOOLEAN}
        </trim>
    </insert>
    <insert id="saveDownloadCategoriesList" parameterType="com.tool.doge.model.DownloadCategories">
        <foreach collection="list" item="item" index="index" separator=";">
            INSERT INTO DOWNLOAD_CATEGORIES
            <trim prefix="(" suffix=")" suffixOverrides=",">
                `url`,`file_name`, `file_hash`, `file_label`, `file_type`, `success`
            </trim>
            <trim prefix="values (" suffix=")" suffixOverrides=",">
                #{item.url}, #{item.fileName}, #{item.fileHash}, #{item.fileLabel}, #{item.fileType}, #{item.success,jdbcType=BOOLEAN}
            </trim>
            WHERE NOT EXISTS (SELECT url FROM DOWNLOAD_CATEGORIES WHERE url = #{item.url})
        </foreach>
    </insert>

    <update id="updateDownloadCategories" parameterType="com.tool.doge.model.DownloadCategories">
        UPDATE DOWNLOAD_CATEGORIES
        <set>
            <if test="success != null" >
                success = #{success,jdbcType=BOOLEAN},
            </if>
        </set>
        WHERE id = #{id,jdbcType=VARCHAR}
    </update>

    <select id="selectDownloadCategories" parameterType="java.lang.Integer">
        SELECT * FROM DOWNLOAD_CATEGORIES
        <where>success = false</where>
        LIMIT #{limit}
    </select>
</mapper>